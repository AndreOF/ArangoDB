<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />


<link rel="shortcut icon" type="image/x-icon" href="http://www.arangodb.org/wp-content/themes/triagens/images/favicon.ico">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.arangodb.org/wp-content/themes/triagens-child/style.css" />
<link rel="pingback" href="" />


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.4 - http://yoast.com/wordpress/seo/ -->
<title>ArangoDB Manual Pages - ArangoDB</title>
<meta name="description" content="ArangoDB Manual Pages"/>
<link rel="canonical" href="http://www.arangodb.org/manualredirector" />
<meta property='og:locale' content='en_US'/>
<meta property='og:title' content='ArangoDB Manual Pages - ArangoDB'/>
<meta property='og:description' content='ArangoDB Manual Pages'/>
<meta property='og:url' content='http://www.arangodb.org/manualredirector'/>
<meta property='og:site_name' content='ArangoDB'/>
<meta property='og:type' content='article'/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Feed" href="http://www.arangodb.org/feed" />
<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Comments Feed" href="http://www.arangodb.org/comments/feed" />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.arangodb.org/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.arangodb.org/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/comment-reply.min.js?ver=3.5.1'></script>

    <style type="text/css">
    body {
    margin-top: -28px;
    padding-bottom: 28px;
    }
    body.admin-bar #wphead {
       padding-top: 0;
    }
    body.admin-bar #footer {
       padding-bottom: 28px;
    }
<link type="text/css" media="screen" rel="stylesheet" href="http://www.arangodb.org/wp-content/plugins/tweet-blender/css/tweets.css" />

    <style media="print" type="text/css">
      div.faq_answer {display: block!important;}
      p.faq_nav {display: none;}
    </style>


</head>

<body class="page page-id-1410 page-template page-template-onecolumn-page-php">

    <div id="access" role="navigation">
        <div id="nav">
            <a href="http://www.arangodb.org/" title="ArangoDB" id="branding"><img src="/wp-content/themes/triagens/images/logo_arangob_white.gif" width="154" height="34" alt="ArangoDB"></a>
            <div class="menu-header"><ul id="menu-home" class="menu"><li id="menu-item-184" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-184"><a href="http://www.arangodb.org/">Home</a></li>
<li id="menu-item-1345" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1345"><a href="http://www.arangodb.org/try">Try it out</a></li>
<li id="menu-item-279" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-279"><a href="http://www.arangodb.org/documentation">Documentation</a></li>
<li id="menu-item-95" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-95"><a href="http://www.arangodb.org/roadmap">Roadmap</a></li>
<li id="menu-item-71" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-71"><a href="http://www.arangodb.org/download">Downloads</a></li>
<li id="menu-item-1299" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1299"><a href="http://www.arangodb.org/api">Drivers</a></li>
<li id="menu-item-156" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-156"><a href="http://www.arangodb.org/blog">Blog</a></li>
</ul></div>            <div class="clear_both"></div>
        </div>
    </div><!-- #access -->

  <div id="surrounding">

    <div id="wrapper" class="hfeed">
	<div id="main">

    <div id="fullsize" class="one-column">
      <div id="content" role="main">



            <div id="post-1410" class="post-1410 page type-page status-publish hentry">
                    <h2 class="entry-title">ArangoDB Manual Pages</h2>

	  <div class="entry-content">

<link id="arangodb.css" type="text/css" href="arangodb.css" rel="stylesheet">
</div>
<div id="manual_search">
<form action="/" id="searchform" method="get" role="search">
  <div><label for="s" class="screen-reader-text">Search for:</label>
    <input type="text" id="s" name="s" value="" />
    <input type="submit" value="Search" id="searchsubmit" />
  </div>
</form>
</div>
<div class="clear_both"></div>
<hr />
<div class="arangodb">
<div>
<!-- Generated by Doxygen 1.8.2 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Upgrading to ArangoDB 1.3 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"> <div class="navigate"><a href="NewFeatures13.html">prev</a> | <a href="Home.html">home</a> | <a href="UserManual.html">next</a></div>  <div class="toc"><ul>
<li><a class="el" href="Upgrading13.html#Upgrading13Introduction">Upgrading </a><ul>
<li><a class="el" href="Upgrading13.html#Upgrading13VersionCheck">Database Directory Version Check and Upgrade </a></li>
<li><a class="el" href="Upgrading13.html#Upgrading13BinaryPackage">Upgrade a binary package </a></li>
<li><a class="el" href="Upgrading13.html#Upgrading13Options">New and Changed Command-Line Options</a></li>
</ul>
</li>
<li><a class="el" href="Upgrading13.html#Upgrading13Troubleshooting">Troubleshooting</a> </li>
</ul>
  </div> <h2><a class="anchor" id="Upgrading13Introduction"></a>
Upgrading </h2>
<p>ArangoDB 1.3 provides a lot of new features and APIs when compared to ArangoDB 1.2. The most important one being true multi-collection transactions support.</p>
<p>The following list contains changes in ArangoDB 1.3 that are not 100% downwards-compatible to ArangoDB 1.2.</p>
<p>Existing users of ArangoDB 1.2 should read the list carefully and make sure they have undertaken all necessary steps and precautions before upgrading from ArangoDB 1.2 to ArangoDB 1.3. Please also check <a class="el" href="Upgrading13.html#Upgrading13Troubleshooting">Troubleshooting</a>.</p>
<h3><a class="anchor" id="Upgrading13VersionCheck"></a>
Database Directory Version Check and Upgrade </h3>
<p>Starting with ArangoDB 1.1, <em>arangod</em> will perform a database version check at startup. This has not changed in ArangoDB 1.3.</p>
<p>The version check will look for a file named <em>VERSION</em> in its database directory. If the file is not present, <em>arangod</em> in version 1.3 will perform an auto-upgrade (can also be considered a database "initialisation"). This auto-upgrade will create the system collections necessary to run ArangoDB, and it will also create the VERSION file with a version number like <code>1.3</code> inside.</p>
<p>If the <em>VERSION</em> file is present but is from a non-matching version of ArangoDB (e.g. ArangoDB 1.2 if you upgrade), <em>arangod</em> will refuse to start. Instead, it will ask you start the server with the option <code>--upgrade</code>. Using the <code>--upgrade</code> option will make the server trigger any required upgrade tasks to migrate data from ArangoDB 1.2 to ArangoDB 1.3.</p>
<p>This manual invocation of an upgrade shall ensure that users have full control over when they perform any updates/upgrades of their data, and do not risk running an incompatible tandem of server and database versions.</p>
<p>If you try starting an ArangoDB 1.3 server with a database created by an earlier version of ArangoDB, and did not invoke the upgrade procedure, the output of ArangoDB will look like this: </p>
<pre class="fragment">&gt; bin/arangod --server.endpoint tcp://127.0.0.1:8529 --database.directory /tmp/12

...
2013-05-10T08:35:59Z [9017] ERROR Database directory version (1.2) is lower than server version (1.3).
2013-05-10T08:35:59Z [9017] ERROR It seems like you have upgraded the ArangoDB binary. If this is what you wanted to do, please restart with the --upgrade option to upgrade the data in the database directory.
2013-05-10T08:35:59Z [9017] FATAL Database version check failed. Please start the server with the --upgrade option
...
</pre><p>So it is really necessary to forcefully invoke the upgrade procedure. Please create a backup of your database directory before upgrading. Please also make sure that the database directory and all subdirectories and files in it are writeable for the user you run ArangoDB with.</p>
<p>As mentioned, invoking the upgrade procedure can be done by specifying the additional command line option <code>--upgrade</code> as follows: </p>
<pre class="fragment">&gt; bin/arangod --server.endpoint tcp://127.0.0.1:8529 --database.directory /tmp/12 --upgrade

...
2013-05-10T08:38:41Z [9039] INFO Starting upgrade from version 1.2 to 1.3
2013-05-10T08:38:41Z [9039] INFO Found 20 defined task(s), 8 task(s) to run
...
2013-05-10T08:38:43Z [9039] INFO Upgrade successfully finished
2013-05-10T08:38:43Z [9039] INFO database version check passed
...
</pre><p>The upgrade procecure will execute the defined tasks to run <em>arangod</em> with all new features and data formats. It should normally run without problems and indicate success at its end. If it detects a problem that it cannot fix, it will halt on the first error and warn you.</p>
<p>Re-starting arangod with the <code>--upgrade</code> option will execute only the previously failed and not yet executed tasks.</p>
<p>Upgrading from ArangoDB 1.2 to ArangoDB 1.3 will rewrite data in the collections' datafiles. The upgrade procedure will create a backup of all files it processes, in case something goes wrong.</p>
<p>In case the upgrade did not produce any problems and ArangoDB works well for you after the upgrade, you may want to remove these backup files manually.</p>
<p>All collection datafiles will be backed up in the original collection directories in the database directory. You can easily detect the backup files because they have a filename ending in <code>.old</code>.</p>
<h3><a class="anchor" id="Upgrading13BinaryPackage"></a>
Upgrade a binary package </h3>
<p>Linux:</p>
<ul>
<li>Upgrade ArangoDB by package manager (Example <code>zypper update arangodb</code>)</li>
<li>check configuration file: <code>/etc/arangodb/arangod.conf</code></li>
<li>Upgrade database files with <code>/etc/init.d/arangodb upgrade</code></li>
</ul>
<p>Mac OS X binary package</p>
<ul>
<li>You can find the new Mac OS X packages here: <code><a href="http://www.arangodb.org/repositories/MacOSX">http://www.arangodb.org/repositories/MacOSX</a></code></li>
<li>check configuration file: <code>/etc/arangodb/arangod.conf</code></li>
<li>Upgrade database files `/usr/sbin/arangod &ndash;upgrade'</li>
</ul>
<p>Mac OS X with homebrew</p>
<ul>
<li>Upgrade ArangoDB by `brew upgrade arangodb'</li>
<li>check configuration file: <code>/usr/local/Cellar/1.X.Y/etc/arangodb/arangod.conf</code></li>
<li>Upgrade database files <code>/usr/local/sbin/arangod --upgrade</code></li>
</ul>
<p>In case you upgrade from a previous version of ArangoDB, please make sure you perform the changes to the configuration file as described in <a class="el" href="Upgrading13.html#Upgrading13Options">New and Changed Command-Line Options</a>. Otherwise ArangoDB 1.3 will not start properly.</p>
<h3><a class="anchor" id="Upgrading13Options"></a>
New and Changed Command-Line Options</h3>
<p>In order to support node modules and packages, a new command-line option was introduced: </p>
<pre class="fragment">--javascript.package-path &lt;directory&gt;
</pre><p>must be used to specify the directory containing the NPM packages. This is option is presented in the pre-defined configuration files. In case a created your own configuration, you need to add this option and also make sure that </p>
<pre class="fragment">--javascript.modules-path &lt;directories&gt;
</pre><p>contains the new <code>node</code> directory.</p>
<p>Example values for <code>--javascript.modules-path</code> and <code>--javascript.package-path</code> are: </p>
<pre class="fragment">--javascript.modules-path = DIR/js/server/modules;DIR/js/common/modules;DIR/js/node

--javascript.package-path = DIR/js/npm
</pre><p>where <code>DIR</code> is the directory that contains the shared data installed by ArangoDB during installation. It might be <code>/usr/local/share/arangodb</code>, but the actual value is system-dependent.</p>
<p>Not adding the <code>node</code> directory to <code>--javascript.modules-path</code> or not setting <code>--javascript.package-path</code> will result in server startup errors.</p>
<p>The configuration options <code>--scheduler.report-intervall</code> and <code>--dispatcher.report-intervall</code> have been renamed to <code>--scheduler.report-interval</code> and <code>--dispatcher.report-interval</code>.</p>
<p>These are rarely used debugging options that are not contained in any of the configuration files shipped with ArangoDB, so the changed name should not have an effect for end users.</p>
<h3><a class="anchor" id="Upgrading13RemovedFeatures"></a>
Removed Features</h3>
<p>The configure options <code>--enable-zone-debug</code> and <code>--enable-arangob</code> have been removed. These should not have been used by end users anyway, so this change should not have an effect.</p>
<h2><a class="anchor" id="Upgrading13Troubleshooting"></a>
Troubleshooting</h2>
<p>If the server does not start after an upgrade, please check that your configuration contains the <code>node</code> directory in the <code>--javascript.modules-path</code>, and that the parameter <code>--javascript.package-path</code> is set.</p>
<p>On systems with rlimit, ArangoDB 1.3 will also require the minimum number of file descriptors it can use to be 256. If the limit is set to a lower value, ArangoDB will try to increase the limit to 256. If raising the limit does fail, ArangoDB will refuse to start, and fail with an error message like </p>
<pre class="fragment">2013-05-10T09:00:40Z [11492] FATAL cannot raise the file descriptor limit to 256, got 'Operation not permitted'
</pre><p>In this case the number of file descriptors should be increased. Please note that 256 is a minimum value and that you should allow ArangoDB to use much more file descriptors if you afford it.</p>
<p>To avoid the file descriptor check on startup in an emergency case, you can use the startup option </p>
<pre class="fragment">--server.descriptors-minimum 0
</pre><p>Please also check the logfile written by ArangoDB for further errors messages. </p>
</div></div><!-- contents -->
</div>


	  </div><!-- .entry-content -->
	</div><!-- #post-## -->


      <div id="comments">


  <p class="nocomments">Comments are closed.</p>



</div><!-- #comments -->


      </div><!-- #content -->
    </div><!-- #container -->

  <div style="clear:both;"></div>
  </div><!-- #main -->



</div><!-- #wrapper -->
</div><!-- #surrounding -->


  <div id="footer" role="contentinfo">
    <div id="colophon">




      <div id="footer-widget-area" role="complementary">

	<div id="first" class="widget-area">
	  <ul class="xoxo">
		<li id="recent-posts-4" class="widget-container widget_recent_entries">	  <h3 class="widget-title">Recent Posts</h3>	<ul>
	  <li>
	<a href="http://www.arangodb.org/2013/05/22/replication-and-sharding-in-arangodb" title="Our plans on replication and sharding in ArangoDB">Our plans on replication and sharding in ArangoDB</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/14/ideas-and-facts-from-scotland-js-in-edinburgh" title="Ideas and Facts from scotland.js in Edinburgh">Ideas and Facts from scotland.js in Edinburgh</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/12/arangodb-1-3-0-released" title="ArangoDB 1.3.0 released">ArangoDB 1.3.0 released</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/06/foxx-screencast-part-2" title="Foxx Screencast: Part 2">Foxx Screencast: Part 2</a>
	    </li>
	</ul>
    </li><li id="text-5" class="widget-container widget_text"><h3 class="widget-title">Documentation</h3>     <div class="textwidget"><ul>
  <li><a href="/quickstart">First step tutorial</a></li>
  <li><a href="/manuals">Manual/documentation (HTML/PDF)</a></li>
  <li><a href="/manuals/arangodb_1.0_shell_reference_card.pdf">ArangoDB Shell Reference Card (HTML/PDF)</a></li>
  <li><a href="/try">Try ArangoDB online</a></li>
  <li><a href="/api">API clients & 3rd party libs</a></li>
        <li><a href="/logos">ArangoDB artwork/logos</a></li>
</ul>
</div>
    </li><li id="text-7" class="widget-container widget_text"><h3 class="widget-title">Social Links</h3>      <div class="textwidget"><ul>
  <li><a href="https://twitter.com/arangodb">ArangoDB on Twitter</a></li>
  <li><a href="https://groups.google.com/group/arangodb">ArangoDB Google Group</a></li>
  <li><a href="http://stackoverflow.com/questions/tagged/arangodb">ArangoDB questions on StackOverflow</a></li>
  <li><a href="https://github.com/triagens/arangodb/issues?state=open">Issue Tracker at Github</a></li>
</ul></div>
    </li><li id="text-6" class="widget-container widget_text"><h3 class="widget-title">Roadmap</h3>	<div class="textwidget"><ul>
  <li><a href="/roadmap/#v1.4">Backlog for Version 1.4</a></li>
  <li><a href="/roadmap/#v1.x">Backlog for Version 1.x</a></li>
</ul></div>
    </li>	  </ul>
	</div><!-- #first .widget-area -->




      </div><!-- #footer-widget-area -->


<!-- #site-generator -->

    </div><!-- #colophon -->

        <div class="copy">
            Copyright 2013 ArangoDB | <a href="/imprint">Imprint</a>
        </div>

  </div><!-- #footer -->

</body>
</html>