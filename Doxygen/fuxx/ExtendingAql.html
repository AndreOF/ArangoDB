<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />


<link rel="shortcut icon" type="image/x-icon" href="http://www.arangodb.org/wp-content/themes/triagens/images/favicon.ico">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.arangodb.org/wp-content/themes/triagens-child/style.css" />
<link rel="pingback" href="" />


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.4 - http://yoast.com/wordpress/seo/ -->
<title>ArangoDB Manual Pages - ArangoDB</title>
<meta name="description" content="ArangoDB Manual Pages"/>
<link rel="canonical" href="http://www.arangodb.org/manualredirector" />
<meta property='og:locale' content='en_US'/>
<meta property='og:title' content='ArangoDB Manual Pages - ArangoDB'/>
<meta property='og:description' content='ArangoDB Manual Pages'/>
<meta property='og:url' content='http://www.arangodb.org/manualredirector'/>
<meta property='og:site_name' content='ArangoDB'/>
<meta property='og:type' content='article'/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Feed" href="http://www.arangodb.org/feed" />
<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Comments Feed" href="http://www.arangodb.org/comments/feed" />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.arangodb.org/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.arangodb.org/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/comment-reply.min.js?ver=3.5.1'></script>

    <style type="text/css">
    body {
    margin-top: -28px;
    padding-bottom: 28px;
    }
    body.admin-bar #wphead {
       padding-top: 0;
    }
    body.admin-bar #footer {
       padding-bottom: 28px;
    }
<link type="text/css" media="screen" rel="stylesheet" href="http://www.arangodb.org/wp-content/plugins/tweet-blender/css/tweets.css" />

    <style media="print" type="text/css">
      div.faq_answer {display: block!important;}
      p.faq_nav {display: none;}
    </style>


</head>

<body class="page page-id-1410 page-template page-template-onecolumn-page-php">

    <div id="access" role="navigation">
        <div id="nav">
            <a href="http://www.arangodb.org/" title="ArangoDB" id="branding"><img src="/wp-content/themes/triagens/images/logo_arangob_white.gif" width="154" height="34" alt="ArangoDB"></a>
            <div class="menu-header"><ul id="menu-home" class="menu"><li id="menu-item-184" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-184"><a href="http://www.arangodb.org/">Home</a></li>
<li id="menu-item-1345" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1345"><a href="http://www.arangodb.org/try">Try it out</a></li>
<li id="menu-item-279" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-279"><a href="http://www.arangodb.org/documentation">Documentation</a></li>
<li id="menu-item-95" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-95"><a href="http://www.arangodb.org/roadmap">Roadmap</a></li>
<li id="menu-item-71" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-71"><a href="http://www.arangodb.org/download">Downloads</a></li>
<li id="menu-item-1299" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1299"><a href="http://www.arangodb.org/api">Drivers</a></li>
<li id="menu-item-156" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-156"><a href="http://www.arangodb.org/blog">Blog</a></li>
</ul></div>            <div class="clear_both"></div>
        </div>
    </div><!-- #access -->

  <div id="surrounding">

    <div id="wrapper" class="hfeed">
	<div id="main">

    <div id="fullsize" class="one-column">
      <div id="content" role="main">



            <div id="post-1410" class="post-1410 page type-page status-publish hentry">
                    <h2 class="entry-title">ArangoDB Manual Pages</h2>

	  <div class="entry-content">

<link id="arangodb.css" type="text/css" href="arangodb.css" rel="stylesheet">
</div>
<div id="manual_search">
<form action="/" id="searchform" method="get" role="search">
  <div><label for="s" class="screen-reader-text">Search for:</label>
    <input type="text" id="s" name="s" value="" />
    <input type="submit" value="Search" id="searchsubmit" />
  </div>
</form>
</div>
<div class="clear_both"></div>
<hr />
<div class="arangodb">
<div>
<!-- Generated by Doxygen 1.8.2 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Extending AQL with User Functions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"> <div class="navigate"><a href="Aql.html">prev</a> | <a href="UserManual.html">home</a> | <a href="AqlExamples.html">next</a></div>  <div class="toc"><ul>
<li><a class="el" href="ExtendingAql.html">Extending AQL with User Functions</a><ul>
<li><a class="el" href="ExtendingAql.html#ExtendingAqlConventions">Conventions </a></li>
<li><a class="el" href="ExtendingAql.html#ExtendingAqlHowTo">Registering and Unregistering User Functions </a> </li>
</ul>
</li>
</ul>
  </div> <h2><a class="anchor" id="ExtendingAqlConventions"></a>
Conventions </h2>
<p>AQL comes with a built-in set of functions, but it is no full-feature programming language.</p>
<p>To add missing functionality or to simplifiy queries, users may add own functions to AQL. These functions can be written in Javascript, and must be registered via an API.</p>
<p>In order to avoid conflicts with existing or future built-in function names, all user functions must be put into separate namespaces. Invoking a user functions is then possible by referring to the fully-qualified function name, which includes the namespace, too.</p>
<p>The <code>:</code> symbol is used inside AQL as the namespace separator. Using the namespace separator, users can create a multi-level hierarchy of function groups if required.</p>
<p>Examples: </p>
<pre class="fragment">RETURN myfunctions:myfunc()

RETURN myfunctions:math:random()
</pre><p>Note: as all function names in AQL, user function names are also case-insensitive.</p>
<p>Built-in AQL functions reside in the namespace <code>_aql</code>, which is also the default namespace to look in if an unqualified function name is found. Adding user functions to the <code>_aql</code> namespace is disallowed and will fail.</p>
<p>User functions can take any number of input arguments and should provide one result. They should be kept purely functional and thus free of side effects and state.</p>
<p>Especially it is unsupported to modify any global variables, or to change data of a collection from an AQL user function.</p>
<p>User function code is late-bound, and may thus not rely on any variables that existed at the time of declaration. If user function code requires access to any external data, it must take care to set up the data by itself.</p>
<p>User functions must only return primitive types (i.e. <code>null</code>, boolean values, numeric values, string values) or aggregate types (lists or documents) composed of these types. Returning any other Javascript object type from a user function may lead to undefined behavior and should be avoided.</p>
<h2><a class="anchor" id="ExtendingAqlHowTo"></a>
Registering and Unregistering User Functions </h2>
<p>AQL user functions can be registered using the <code>aqlfunctions</code> object as follows: </p>
<pre class="fragment">var aqlfunctions = require("org/arangodb/aql/functions");
</pre><p>To register a function, the fully qualified function name plus the function code must be specified.</p>
<p> <div class="functionsignature">aqlfunctions.register(<span class="functionargument">name</span>,  <span class="functionargument">code</span>,  <span class="functionargument">isDeterministic</span>) </div>Registers an AQL user function, identified by a fully qualified function name. The function code in  <span class="functionargument">code</span> must be specified as a Javascript function or a string representation of a Javascript function.If a function identified by  <span class="functionargument">name</span> already exists, the previous function definition will be updated.The  <span class="functionargument">isDeterministic</span> attribute can be used to specify whether the function results are fully deterministic (i.e. depend solely on the input and are the same for repeated calls with the same input values). It is not used at the moment but may be used for optimisations later. <H3>Examples</H3><div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).register(<span class="stringliteral">&quot;myfunctions:temperature:celsiustofahrenheit&quot;</span>, </div>
<div class="line">                  <span class="keyword">function</span> (celsius) {</div>
<div class="line">                    <span class="keywordflow">return</span> celsius * 1.8 + 32; </div>
<div class="line">                  });</div>
</div><!-- fragment --> </p>
<p>It is possible to unregister a single user function, or a whole group of user functions (identified by their namespace) in one go:</p>
<p> <div class="functionsignature">aqlfunctions.unregister(<span class="functionargument">name</span>) </div>Unregisters an existing AQL user function, identified by the fully qualified function name.Trying to unregister a function that does not exist will result in an exception. <H3>Examples</H3><div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).unregister(<span class="stringliteral">&quot;myfunctions:temperature:celsiustofahrenheit&quot;</span>);</div>
</div><!-- fragment --> </p>
<p> <div class="functionsignature">aqlfunctions.unregisterGroup(<span class="functionargument">prefix</span>) </div>Unregisters a group of AQL user function, identified by a common function group prefix.This will return the number of functions unregistered. <H3>Examples</H3><div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).unregisterGroup(<span class="stringliteral">&quot;myfunctions:temperature&quot;</span>);</div>
<div class="line"></div>
<div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).unregisterGroup(<span class="stringliteral">&quot;myfunctions&quot;</span>);</div>
</div><!-- fragment --> </p>
<p>To get an overview of which functions are currently registered, the <code>toArray</code> function can be used:</p>
<p> <div class="functionsignature">aqlfunctions.toArray()</div>Returns all previously registered AQL user functions, with their fully qualified names and function code.The result may optionally be restricted to a specified group of functions by specifying a group prefix: <div class="functionsignature">aqlfunctions.toArray(<span class="functionargument">prefix</span>) </div> <H3>Examples</H3>To list all available user functions:<div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).toArray();</div>
</div><!-- fragment -->To list all available user functions in the <code>myfunctions</code> namespace:<div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).toArray(<span class="stringliteral">&quot;myfunctions&quot;</span>);</div>
</div><!-- fragment -->To list all available user functions in the <code>myfunctions:temperature</code> namespace:<div class="fragment"><div class="line">arangosh&gt; require(<span class="stringliteral">&quot;org/arangodb/aql/functions&quot;</span>).toArray(<span class="stringliteral">&quot;myfunctions:temperature&quot;</span>);</div>
</div><!-- fragment -->  </p>
</div></div><!-- contents -->
</div>


	  </div><!-- .entry-content -->
	</div><!-- #post-## -->


      <div id="comments">


  <p class="nocomments">Comments are closed.</p>



</div><!-- #comments -->


      </div><!-- #content -->
    </div><!-- #container -->

  <div style="clear:both;"></div>
  </div><!-- #main -->



</div><!-- #wrapper -->
</div><!-- #surrounding -->


  <div id="footer" role="contentinfo">
    <div id="colophon">




      <div id="footer-widget-area" role="complementary">

	<div id="first" class="widget-area">
	  <ul class="xoxo">
		<li id="recent-posts-4" class="widget-container widget_recent_entries">	  <h3 class="widget-title">Recent Posts</h3>	<ul>
	  <li>
	<a href="http://www.arangodb.org/2013/05/22/replication-and-sharding-in-arangodb" title="Our plans on replication and sharding in ArangoDB">Our plans on replication and sharding in ArangoDB</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/14/ideas-and-facts-from-scotland-js-in-edinburgh" title="Ideas and Facts from scotland.js in Edinburgh">Ideas and Facts from scotland.js in Edinburgh</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/12/arangodb-1-3-0-released" title="ArangoDB 1.3.0 released">ArangoDB 1.3.0 released</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/06/foxx-screencast-part-2" title="Foxx Screencast: Part 2">Foxx Screencast: Part 2</a>
	    </li>
	</ul>
    </li><li id="text-5" class="widget-container widget_text"><h3 class="widget-title">Documentation</h3>     <div class="textwidget"><ul>
  <li><a href="/quickstart">First step tutorial</a></li>
  <li><a href="/manuals">Manual/documentation (HTML/PDF)</a></li>
  <li><a href="/manuals/arangodb_1.0_shell_reference_card.pdf">ArangoDB Shell Reference Card (HTML/PDF)</a></li>
  <li><a href="/try">Try ArangoDB online</a></li>
  <li><a href="/api">API clients & 3rd party libs</a></li>
        <li><a href="/logos">ArangoDB artwork/logos</a></li>
</ul>
</div>
    </li><li id="text-7" class="widget-container widget_text"><h3 class="widget-title">Social Links</h3>      <div class="textwidget"><ul>
  <li><a href="https://twitter.com/arangodb">ArangoDB on Twitter</a></li>
  <li><a href="https://groups.google.com/group/arangodb">ArangoDB Google Group</a></li>
  <li><a href="http://stackoverflow.com/questions/tagged/arangodb">ArangoDB questions on StackOverflow</a></li>
  <li><a href="https://github.com/triagens/arangodb/issues?state=open">Issue Tracker at Github</a></li>
</ul></div>
    </li><li id="text-6" class="widget-container widget_text"><h3 class="widget-title">Roadmap</h3>	<div class="textwidget"><ul>
  <li><a href="/roadmap/#v1.4">Backlog for Version 1.4</a></li>
  <li><a href="/roadmap/#v1.x">Backlog for Version 1.x</a></li>
</ul></div>
    </li>	  </ul>
	</div><!-- #first .widget-area -->




      </div><!-- #footer-widget-area -->


<!-- #site-generator -->

    </div><!-- #colophon -->

        <div class="copy">
            Copyright 2013 ArangoDB | <a href="/imprint">Imprint</a>
        </div>

  </div><!-- #footer -->

</body>
</html>