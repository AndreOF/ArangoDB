<!DOCTYPE html>
<html lang="en-US" prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />


<link rel="shortcut icon" type="image/x-icon" href="http://www.arangodb.org/wp-content/themes/triagens/images/favicon.ico">

<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://www.arangodb.org/wp-content/themes/triagens-child/style.css" />
<link rel="pingback" href="" />


<!-- This site is optimized with the Yoast WordPress SEO plugin v1.4.4 - http://yoast.com/wordpress/seo/ -->
<title>ArangoDB Manual Pages - ArangoDB</title>
<meta name="description" content="ArangoDB Manual Pages"/>
<link rel="canonical" href="http://www.arangodb.org/manualredirector" />
<meta property='og:locale' content='en_US'/>
<meta property='og:title' content='ArangoDB Manual Pages - ArangoDB'/>
<meta property='og:description' content='ArangoDB Manual Pages'/>
<meta property='og:url' content='http://www.arangodb.org/manualredirector'/>
<meta property='og:site_name' content='ArangoDB'/>
<meta property='og:type' content='article'/>
<!-- / Yoast WordPress SEO plugin. -->

<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Feed" href="http://www.arangodb.org/feed" />
<link rel="alternate" type="application/rss+xml" title="ArangoDB &raquo; Comments Feed" href="http://www.arangodb.org/comments/feed" />
<link rel='stylesheet' id='wordpress-popular-posts-css'  href='http://www.arangodb.org/wp-content/plugins/wordpress-popular-posts/style/wpp.css?ver=3.5.1' type='text/css' media='all' />
<link rel='stylesheet' id='wp-syntax-css-css'  href='http://www.arangodb.org/wp-content/plugins/wp-syntax/css/wp-syntax.css?ver=1.0' type='text/css' media='all' />
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<script type='text/javascript' src='http://www.arangodb.org/wp-includes/js/comment-reply.min.js?ver=3.5.1'></script>

    <style type="text/css">
    body {
    margin-top: -28px;
    padding-bottom: 28px;
    }
    body.admin-bar #wphead {
       padding-top: 0;
    }
    body.admin-bar #footer {
       padding-bottom: 28px;
    }
<link type="text/css" media="screen" rel="stylesheet" href="http://www.arangodb.org/wp-content/plugins/tweet-blender/css/tweets.css" />

    <style media="print" type="text/css">
      div.faq_answer {display: block!important;}
      p.faq_nav {display: none;}
    </style>


</head>

<body class="page page-id-1410 page-template page-template-onecolumn-page-php">

    <div id="access" role="navigation">
        <div id="nav">
            <a href="http://www.arangodb.org/" title="ArangoDB" id="branding"><img src="/wp-content/themes/triagens/images/logo_arangob_white.gif" width="154" height="34" alt="ArangoDB"></a>
            <div class="menu-header"><ul id="menu-home" class="menu"><li id="menu-item-184" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-184"><a href="http://www.arangodb.org/">Home</a></li>
<li id="menu-item-1345" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1345"><a href="http://www.arangodb.org/try">Try it out</a></li>
<li id="menu-item-279" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-279"><a href="http://www.arangodb.org/documentation">Documentation</a></li>
<li id="menu-item-95" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-95"><a href="http://www.arangodb.org/roadmap">Roadmap</a></li>
<li id="menu-item-71" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-71"><a href="http://www.arangodb.org/download">Downloads</a></li>
<li id="menu-item-1299" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1299"><a href="http://www.arangodb.org/api">Drivers</a></li>
<li id="menu-item-156" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-156"><a href="http://www.arangodb.org/blog">Blog</a></li>
</ul></div>            <div class="clear_both"></div>
        </div>
    </div><!-- #access -->

  <div id="surrounding">

    <div id="wrapper" class="hfeed">
	<div id="main">

    <div id="fullsize" class="one-column">
      <div id="content" role="main">



            <div id="post-1410" class="post-1410 page type-page status-publish hentry">
                    <h2 class="entry-title">ArangoDB Manual Pages</h2>

	  <div class="entry-content">

<link id="arangodb.css" type="text/css" href="arangodb.css" rel="stylesheet">
</div>
<div id="manual_search">
<form action="/" id="searchform" method="get" role="search">
  <div><label for="s" class="screen-reader-text">Search for:</label>
    <input type="text" id="s" name="s" value="" />
    <input type="submit" value="Search" id="searchsubmit" />
  </div>
</form>
</div>
<div class="clear_both"></div>
<hr />
<div class="arangodb">
<div>
<!-- Generated by Doxygen 1.8.2 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AQL Examples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"> <div class="navigate"><a href="ExtendingAql.html">prev</a> | <a href="UserManual.html">home</a> | <a href="UserManualActions.html">next</a></div>  <div class="toc"><ul>
<li><a class="el" href="AqlExamples.html">AQL Examples</a> </li>
</ul>
  </div> <h2><a class="anchor" id="AqlExamplesSimple"></a>
Simple queries </h2>
<p>This page contains some examples for how to write queries in AQL. For better understandability, the query results are also included directly below each query.</p>
<p>A query that returns a string value. the result string is contained in a list because the result of every valid query is a list: </p>
<pre class="fragment">RETURN "this will be returned"

[ 
  "this will be returned" 
]
</pre><p>Here's a query that creates the cross products of two lists, and runs a projection on it, using a few of AQL's built-in functions: </p>
<pre class="fragment">FOR year in [ 2011, 2012, 2013 ]
  FOR quarter IN [ 1, 2, 3, 4 ]
    RETURN { 
      "y" : "year", 
      "q" : quarter, 
      "nice" : CONCAT(TO_STRING(quarter), "/", TO_STRING(year)) 
    }

[ 
  { "y" : "year", "q" : 1, "nice" : "1/2011" }, 
  { "y" : "year", "q" : 2, "nice" : "2/2011" }, 
  { "y" : "year", "q" : 3, "nice" : "3/2011" }, 
  { "y" : "year", "q" : 4, "nice" : "4/2011" }, 
  { "y" : "year", "q" : 1, "nice" : "1/2012" }, 
  { "y" : "year", "q" : 2, "nice" : "2/2012" }, 
  { "y" : "year", "q" : 3, "nice" : "3/2012" }, 
  { "y" : "year", "q" : 4, "nice" : "4/2012" }, 
  { "y" : "year", "q" : 1, "nice" : "1/2013" }, 
  { "y" : "year", "q" : 2, "nice" : "2/2013" }, 
  { "y" : "year", "q" : 3, "nice" : "3/2013" }, 
  { "y" : "year", "q" : 4, "nice" : "4/2013" } 
]
</pre><h2><a class="anchor" id="AqlExamplesCollection"></a>
Collection-based queries </h2>
<p>Normally you would want to run queries on data stored in collections. This section will provide several examples for that.</p>
<h3>Example data</h3>
<p>Some of the following example queries are executed on a collection <code>users</code> with the following initial data: </p>
<pre class="fragment">[ 
  { "id" : 100, "name" : "John", "age" : 37, "active" : true, "gender" : "m" },
  { "id" : 101, "name" : "Fred", "age" : 36, "active" : true, "gender" : "m" },
  { "id" : 102, "name" : "Jacob", "age" : 35, "active" : false, "gender" : "m" },
  { "id" : 103, "name" : "Ethan", "age" : 34, "active" : false, "gender" : "m" },
  { "id" : 104, "name" : "Michael", "age" : 33, "active" : true, "gender" : "m" },
  { "id" : 105, "name" : "Alexander", "age" : 32, "active" : true, "gender" : "m" },
  { "id" : 106, "name" : "Daniel", "age" : 31, "active" : true, "gender" : "m" },
  { "id" : 107, "name" : "Anthony", "age" : 30, "active" : true, "gender" : "m" },
  { "id" : 108, "name" : "Jim", "age" : 29, "active" : true, "gender" : "m" },
  { "id" : 109, "name" : "Diego", "age" : 28, "active" : true, "gender" : "m" },
  { "id" : 200, "name" : "Sophia", "age" : 37, "active" : true, "gender" : "f" },
  { "id" : 201, "name" : "Emma", "age" : 36,  "active" : true, "gender" : "f" },
  { "id" : 202, "name" : "Olivia", "age" : 35, "active" : false, "gender" : "f" },
  { "id" : 203, "name" : "Madison", "age" : 34, "active" : true, "gender": "f" },
  { "id" : 204, "name" : "Chloe", "age" : 33, "active" : true, "gender" : "f" },
  { "id" : 205, "name" : "Eva", "age" : 32, "active" : false, "gender" : "f" },
  { "id" : 206, "name" : "Abigail", "age" : 31, "active" : true, "gender" : "f" },
  { "id" : 207, "name" : "Isabella", "age" : 30, "active" : true, "gender" : "f" },
  { "id" : 208, "name" : "Mary", "age" : 29, "active" : true, "gender" : "f" },
  { "id" : 209, "name" : "Mariah", "age" : 28, "active" : true, "gender" : "f" }
]
</pre><p>For some of the examples, we'll also use a collection <code>relations</code> to store relationships between users. The example data for <code>relations</code> are as follows: </p>
<pre class="fragment">[
  { "from" : 209, "to" : 205, "type" : "friend" },
  { "from" : 206, "to" : 108, "type" : "friend" },
  { "from" : 202, "to" : 204, "type" : "friend" },
  { "from" : 200, "to" : 100, "type" : "friend" },
  { "from" : 205, "to" : 101, "type" : "friend" },
  { "from" : 209, "to" : 203, "type" : "friend" },
  { "from" : 200, "to" : 203, "type" : "friend" },
  { "from" : 100, "to" : 208, "type" : "friend" },
  { "from" : 101, "to" : 209, "type" : "friend" },
  { "from" : 206, "to" : 102, "type" : "friend" },
  { "from" : 104, "to" : 100, "type" : "friend" },
  { "from" : 104, "to" : 108, "type" : "friend" },
  { "from" : 108, "to" : 209, "type" : "friend" },
  { "from" : 206, "to" : 106, "type" : "friend" },
  { "from" : 204, "to" : 105, "type" : "friend" },
  { "from" : 208, "to" : 207, "type" : "friend" },
  { "from" : 102, "to" : 108, "type" : "friend" },
  { "from" : 207, "to" : 203, "type" : "friend" },
  { "from" : 203, "to" : 106, "type" : "friend" },
  { "from" : 202, "to" : 108, "type" : "friend" },
  { "from" : 201, "to" : 203, "type" : "friend" },
  { "from" : 105, "to" : 100, "type" : "friend" },
  { "from" : 100, "to" : 109, "type" : "friend" },
  { "from" : 207, "to" : 109, "type" : "friend" },
  { "from" : 103, "to" : 203, "type" : "friend" },
  { "from" : 208, "to" : 104, "type" : "friend" },
  { "from" : 105, "to" : 104, "type" : "friend" },
  { "from" : 103, "to" : 208, "type" : "friend" },
  { "from" : 203, "to" : 107, "type" : "boyfriend" },
  { "from" : 107, "to" : 203, "type" : "girlfriend" },
  { "from" : 208, "to" : 109, "type" : "boyfriend" },
  { "from" : 109, "to" : 208, "type" : "girlfriend" },
  { "from" : 106, "to" : 205, "type" : "girlfriend" },
  { "from" : 205, "to" : 106, "type" : "boyfriend" },
  { "from" : 103, "to" : 209, "type" : "girlfriend" },
  { "from" : 209, "to" : 103, "type" : "boyfriend" },
  { "from" : 201, "to" : 102, "type" : "boyfriend" },
  { "from" : 102, "to" : 201, "type" : "girlfriend" },
  { "from" : 206, "to" : 100, "type" : "boyfriend" },
  { "from" : 100, "to" : 206, "type" : "girlfriend" }
]
</pre><h3>Things to consider when running queries on collections</h3>
<p>Note that all documents created in the two collections will automatically get the following server-generated attributes:</p>
<p><code>_id</code>: a unique id, consisting of collection name and a server-side sequence value</p>
<p><code>_key</code>: the server sequence value</p>
<p><code>_rev</code>: the document's revision id</p>
<p>Whenever you run queries on the documents in the two collections, don't be surprised if these additional attributes are returned as well.</p>
<p>Please also note that with real-world data, you might want to create additional indexes on the data (left out here for brevity). Adding indexes on attributes that are used in <code>FILTER</code> statements may considerably speed up queries. Furthermore, instead of using attributes such as <code>id</code>, <code>from</code>, and <code>to</code>, you might want to use the built-in <code>_id</code>, <code>_from</code> and <code>to</code> attributes. Finally, edge collections provide a nice way of establishing references / links between documents. These features have been left out here for brevity as well.</p>
<h2><a class="anchor" id="AqlExamplesProjection"></a>
Projections and Filters </h2>
<h3>Returning unaltered documents</h3>
<p>To return 3 complete documents from collection <code>users</code>, the following query can be used: </p>
<pre class="fragment">FOR u IN users 
  LIMIT 0, 3
  RETURN u

[ 
  { 
    "_id" : "users/229886047207520", 
    "_rev" : "229886047207520", 
    "_key" : "229886047207520", 
    "active" : true, 
    "id" : 206, 
    "age" : 31, 
    "gender" : "f", 
    "name" : "Abigail" 
  }, 
  { 
    "_id" : "users/229886045175904", 
    "_rev" : "229886045175904", 
    "_key" : "229886045175904", 
    "active" : true, 
    "id" : 101, 
    "age" : 36, 
    "name" : "Fred", 
    "gender" : "m" 
  }, 
  { 
    "_id" : "users/229886047469664", 
    "_rev" : "229886047469664", 
    "_key" : "229886047469664", 
    "active" : true, 
    "id" : 208, 
    "age" : 29, 
    "name" : "Mary", 
    "gender" : "f" 
  }
]
</pre><p>Note that there is a <code>LIMIT</code> clause but no <code>SORT</code> clause. In this case it is not guaranteed which of the user documents are returned. Effectively the document return order is unspecified if no <code>SORT</code> clause is used, and you should not rely on the order in such queries.</p>
<h3>Projections</h3>
<p>To return a projection from the collection <code>users</code>, use a modified <code>RETURN</code> instruction: </p>
<pre class="fragment">FOR u IN users 
  LIMIT 0, 3
  RETURN { 
    "user" : { 
      "isActive" : u.active ? "yes" : "no", 
      "name" : u.name 
    } 
  }

[ 
  { 
    "user" : { 
      "isActive" : "yes", 
      "name" : "John" 
    } 
  }, 
  { 
    "user" : { 
      "isActive" : "yes", 
      "name" : "Anthony" 
    } 
  }, 
  { 
    "user" : { 
      "isActive" : "yes", 
      "name" : "Fred" 
    } 
  }
]
</pre><h3>Filters</h3>
<p>To return a filtered projection from collection <code>users</code>, you can use the <code>FILTER</code> keyword. Additionally, a <code>SORT</code> clause is used to have the result returned in a specific order: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true &amp;&amp; u.age &gt;= 30
  SORT u.age DESC
  LIMIT 0, 5
  RETURN { 
    "age" : u.age, 
    "name" : u.name 
  }

[ 
  { 
    "age" : 37, 
      "name" : "Sophia" 
  }, 
  { 
    "age" : 37, 
    "name" : "John" 
  }, 
  { 
    "age" : 36, 
    "name" : "Emma" 
  }, 
  { 
    "age" : 36, 
    "name" : "Fred" 
  }, 
  { 
    "age" : 34, 
    "name" : "Madison" 
  } 
]
</pre><h2><a class="anchor" id="AqlExamplesJoins"></a>
Joins </h2>
<p>So far we have only dealt with one collection (<code>users</code>) at a time. We also have a collection <code>relations</code> that stores relationships between users. We will now use this extra collection to create a result from two collections.</p>
<p>First of all, we'll query a few users together with their friends' ids. For that, we'll use all <code>relations</code> that have a value of <code>friend</code> in their <code>type</code> attribute. Relationships are established by using the <code>from</code> and <code>to</code> attributes in the <code>relations</code> collection, which point to the <code>id</code> values in the <code>users</code> collection.</p>
<h3>Join tuples</h3>
<p>We'll start with an SQL-ish result set and return each tuple (user name, friend id) separately. The AQL query to generate such result is: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true 
  LIMIT 0, 4 
  FOR f IN relations 
    FILTER f.type == "friend" &amp;&amp; f.from == u.id 
    RETURN { 
      "user" : u.name, 
      "friendId" : f.to 
    }

[ 
  { 
    "user" : "Abigail", 
    "friendId" : 108 
  }, 
  { 
    "user" : "Abigail", 
    "friendId" : 102 
  }, 
  { 
    "user" : "Abigail", 
    "friendId" : 106 
  }, 
  { 
    "user" : "Fred", 
    "friendId" : 209 
  }, 
  { 
    "user" : "Mary", 
    "friendId" : 207 
  }, 
  { 
    "user" : "Mary", 
    "friendId" : 104 
  }, 
  { 
    "user" : "Mariah", 
    "friendId" : 203 
  }, 
  { 
    "user" : "Mariah", 
    "friendId" : 205 
  } 
]
</pre><h3>Horizontal lists</h3>
<p>Note that in the above result, a user might be returned multiple times. This is the SQL way of returning data. If this is not desired, the friends' ids of each user can be returned in a horizontal list. This will each user at most once.</p>
<p>The AQL query for doing so is: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true LIMIT 0, 4 
  RETURN { 
    "user" : u.name, 
    "friendIds" : (
      FOR f IN relations 
        FILTER f.from == u.id &amp;&amp; f.type == "friend"
        RETURN f.to
    )
  }

[ 
  { 
    "user" : "Abigail", 
    "friendIds" : [ 
      108, 
      102, 
      106 
    ] 
  }, 
  { 
    "user" : "Fred", 
    "friendIds" : [ 
      209 
    ] 
  }, 
  { 
    "user" : "Mary", 
    "friendIds" : [ 
      207, 
      104 
    ] 
  }, 
  { 
    "user" : "Mariah", 
    "friendIds" : [ 
      203, 
      205 
    ] 
  } 
]
</pre><p>In this query, we're still iterating over the users in the <code>users</code> collection, and for each matching user we are executing a sub-query to create the matching list of related users.</p>
<h3>Self joins</h3>
<p>To not only return friend ids but also the names of friends, we could "join" the <code>users</code> collection once more (something like a "self join"): </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true 
  LIMIT 0, 4 
  RETURN { 
    "user" : u.name, 
    "friendIds" : (
      FOR f IN relations 
        FILTER f.from == u.id &amp;&amp; f.type == "friend" 
        FOR u2 IN users 
          FILTER f.to == u2.id 
          RETURN u2.name
    ) 
  }    

[ 
  { 
    "user" : "Abigail", 
    "friendIds" : [ 
      "Jim", 
      "Jacob", 
      "Daniel" 
    ] 
  }, 
  { 
    "user" : "Fred", 
    "friendIds" : [ 
      "Mariah" 
    ] 
  }, 
  { 
    "user" : "Mary", 
    "friendIds" : [ 
      "Isabella", 
      "Michael" 
    ] 
  }, 
  { 
    "user" : "Mariah", 
    "friendIds" : [ 
      "Madison", 
      "Eva" 
    ] 
  } 
]
</pre><h2><a class="anchor" id="AqlExamplesGrouping"></a>
Grouping </h2>
<p>To group results by arbitrary criteria, AQL provides the <code>COLLECT</code> keyword. <code>COLLECT</code> will perform a grouping, but no aggregation. Aggregation can still be added in the query if required.</p>
<h3>Grouping by criteria</h3>
<p>To group users by age, and result the names of the users with the highest ages, we'll issue a query like this: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true 
  COLLECT age = u.age INTO usersByAge 
  SORT age DESC LIMIT 0, 5 
  RETURN { 
    "age" : age, 
    "users" : usersByAge[*].u.name 
  }

[ 
  { 
    "age" : 37, 
    "users" : [ 
      "John", 
      "Sophia" 
    ] 
  }, 
  { 
    "age" : 36, 
    "users" : [ 
      "Fred", 
      "Emma" 
    ] 
  }, 
  { 
    "age" : 34, 
    "users" : [ 
      "Madison" 
    ] 
  }, 
  { 
    "age" : 33, 
    "users" : [ 
      "Chloe", 
      "Michael" 
    ] 
  }, 
  { 
    "age" : 32, 
    "users" : [ 
      "Alexander" 
    ] 
  } 
]
</pre><p>The query will put all users together by their <code>age</code> attribute. There will be one result document per distinct <code>age</code> value (let aside the <code>LIMIT</code>). For each group, we have access to the matching document via the <code>usersByAge</code> variable introduced in the <code>COLLECT</code> statement.</p>
<h3>[*] list expander</h3>
<p>The <code>usersByAge</code> variable contains the full documents found, and as we're only interested in user names, we'll use the list expander (<code>[*]</code>) to extract just the <code>name</code> attribute of all user documents in each group.</p>
<p>The <code>[*]</code> expander is just a handy short-cut. Instead of <code>usersByAge[*].u.name</code> we could also write: </p>
<pre class="fragment">FOR temp IN usersByAge
  RETURN temp.u.name
</pre><h3>Grouping by multiple criteria</h3>
<p>To group by multiple criteria, we'll use multiple arguments in the <code>COLLECT</code> clause. For example, to group users by <code>ageGroup</code> (a derived value we need to calculate first) and then by <code>gender</code>, we'll do: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true
  COLLECT ageGroup = FLOOR(u.age / 5) * 5, 
          gender = u.gender INTO group
  SORT ageGroup DESC
  RETURN { 
    "ageGroup" : ageGroup, 
    "gender" : gender 
  }

[ 
  { 
    "ageGroup" : 35, 
    "gender" : "f" 
  }, 
  { 
    "ageGroup" : 35, 
    "gender" : "m" 
  }, 
  { 
    "ageGroup" : 30, 
    "gender" : "f" 
  }, 
  { 
    "ageGroup" : 30, 
    "gender" : "m" 
  }, 
  { 
    "ageGroup" : 25, 
    "gender" : "f" 
  }, 
  { 
    "ageGroup" : 25, 
    "gender" : "m" 
  } 
]
</pre><h3>Aggregation</h3>
<p>So far we only grouped data without aggregation. Adding aggregation is simple in AQL, as all that needs to be done is to run an aggregate function on the list created by the <code>INTO</code> clause of a <code>COLLECT</code> statement: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true
  COLLECT ageGroup = FLOOR(u.age / 5) * 5, 
          gender = u.gender INTO group
  SORT ageGroup DESC
  RETURN { 
    "ageGroup" : ageGroup, 
    "gender" : gender, 
    "numUsers" : LENGTH(group) 
  }

[ 
  { 
    "ageGroup" : 35, 
    "gender" : "f", 
    "numUsers" : 2 
  }, 
  { 
    "ageGroup" : 35, 
    "gender" : "m", 
    "numUsers" : 2 
  }, 
  { 
    "ageGroup" : 30, 
    "gender" : "f", 
    "numUsers" : 4 
  }, 
  { 
    "ageGroup" : 30, 
    "gender" : "m", 
    "numUsers" : 4 
  }, 
  { 
    "ageGroup" : 25, 
    "gender" : "f", 
    "numUsers" : 2 
  }, 
  { 
    "ageGroup" : 25, 
    "gender" : "m", 
    "numUsers" : 2 
  } 
]
</pre><p>We have used the function <code>LENGTH</code> (returns the length of a list) here. This is the equivalent to SQL's <code>SELECT g, COUNT(*) FROM ... GROUP BY g</code>. In addition to <code>LENGTH</code>, AQL also provides <code>MAX</code>, <code>MIN</code>, <code>SUM</code>, and <code>AVERAGE</code> as basic aggregation functions.</p>
<p>In AQL, all aggregation functions can be run on lists only. If an aggregation function is run on anything that is not a list, an error will be thrown and the query will fail.</p>
<h3>Post-filtering aggregated data ("Having")</h3>
<p>To filter on the results of a grouping or aggregation operation (i.e. something similar to <code>HAVING</code> in SQL), simply add another <code>FILTER</code> clause after the <code>COLLECT</code> statement.</p>
<p>For example, to get the 3 <code>ageGroup</code>s with the most users in them: </p>
<pre class="fragment">FOR u IN users 
  FILTER u.active == true 
  COLLECT ageGroup = FLOOR(u.age / 5) * 5 INTO group 
  LET numUsers = LENGTH(group) 
  FILTER numUsers &gt; 2 /* group must contain at least 3 users in order to qualify */
  SORT numUsers DESC 
  LIMIT 0, 3 
  RETURN { 
    "ageGroup" : ageGroup, 
    "numUsers" : numUsers, 
    "users" : group[*].u.name 
  }

[ 
  { 
    "ageGroup" : 30, 
    "numUsers" : 8, 
    "users" : [ 
      "Abigail", 
      "Madison", 
      "Anthony", 
      "Alexander", 
      "Isabella", 
      "Chloe", 
      "Daniel", 
      "Michael" 
    ] 
  }, 
  { 
    "ageGroup" : 25, 
    "numUsers" : 4, 
    "users" : [ 
      "Mary", 
      "Mariah", 
      "Jim", 
      "Diego" 
    ] 
  }, 
  { 
    "ageGroup" : 35, 
    "numUsers" : 4, 
    "users" : [ 
      "Fred", 
      "John", 
      "Emma", 
      "Sophia" 
    ] 
  } 
]
</pre><p>To increase readability, the repeated expression <code>LENGTH(group)</code> was put into a variable <code>numUsers</code>. The <code>FILTER</code> on <code>numUsers</code> is the SQL HAVING equivalent. </p>
</div></div><!-- contents -->
</div>


	  </div><!-- .entry-content -->
	</div><!-- #post-## -->


      <div id="comments">


  <p class="nocomments">Comments are closed.</p>



</div><!-- #comments -->


      </div><!-- #content -->
    </div><!-- #container -->

  <div style="clear:both;"></div>
  </div><!-- #main -->



</div><!-- #wrapper -->
</div><!-- #surrounding -->


  <div id="footer" role="contentinfo">
    <div id="colophon">




      <div id="footer-widget-area" role="complementary">

	<div id="first" class="widget-area">
	  <ul class="xoxo">
		<li id="recent-posts-4" class="widget-container widget_recent_entries">	  <h3 class="widget-title">Recent Posts</h3>	<ul>
	  <li>
	<a href="http://www.arangodb.org/2013/05/22/replication-and-sharding-in-arangodb" title="Our plans on replication and sharding in ArangoDB">Our plans on replication and sharding in ArangoDB</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/14/ideas-and-facts-from-scotland-js-in-edinburgh" title="Ideas and Facts from scotland.js in Edinburgh">Ideas and Facts from scotland.js in Edinburgh</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/12/arangodb-1-3-0-released" title="ArangoDB 1.3.0 released">ArangoDB 1.3.0 released</a>
	    </li>
	  <li>
	<a href="http://www.arangodb.org/2013/05/06/foxx-screencast-part-2" title="Foxx Screencast: Part 2">Foxx Screencast: Part 2</a>
	    </li>
	</ul>
    </li><li id="text-5" class="widget-container widget_text"><h3 class="widget-title">Documentation</h3>     <div class="textwidget"><ul>
  <li><a href="/quickstart">First step tutorial</a></li>
  <li><a href="/manuals">Manual/documentation (HTML/PDF)</a></li>
  <li><a href="/manuals/arangodb_1.0_shell_reference_card.pdf">ArangoDB Shell Reference Card (HTML/PDF)</a></li>
  <li><a href="/try">Try ArangoDB online</a></li>
  <li><a href="/api">API clients & 3rd party libs</a></li>
        <li><a href="/logos">ArangoDB artwork/logos</a></li>
</ul>
</div>
    </li><li id="text-7" class="widget-container widget_text"><h3 class="widget-title">Social Links</h3>      <div class="textwidget"><ul>
  <li><a href="https://twitter.com/arangodb">ArangoDB on Twitter</a></li>
  <li><a href="https://groups.google.com/group/arangodb">ArangoDB Google Group</a></li>
  <li><a href="http://stackoverflow.com/questions/tagged/arangodb">ArangoDB questions on StackOverflow</a></li>
  <li><a href="https://github.com/triagens/arangodb/issues?state=open">Issue Tracker at Github</a></li>
</ul></div>
    </li><li id="text-6" class="widget-container widget_text"><h3 class="widget-title">Roadmap</h3>	<div class="textwidget"><ul>
  <li><a href="/roadmap/#v1.4">Backlog for Version 1.4</a></li>
  <li><a href="/roadmap/#v1.x">Backlog for Version 1.x</a></li>
</ul></div>
    </li>	  </ul>
	</div><!-- #first .widget-area -->




      </div><!-- #footer-widget-area -->


<!-- #site-generator -->

    </div><!-- #colophon -->

        <div class="copy">
            Copyright 2013 ArangoDB | <a href="/imprint">Imprint</a>
        </div>

  </div><!-- #footer -->

</body>
</html>